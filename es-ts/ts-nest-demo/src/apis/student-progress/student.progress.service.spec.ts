/* eslint-disable max-len */
/* eslint-disable unicorn/no-zero-fractions */
/* eslint-disable max-lines */
import { HttpModule } from "@nestjs/common";
import { ConfigService } from "@nestjs/config";
import { Test, TestingModule } from "@nestjs/testing";
import { EntityManager } from "typeorm";
import { MapType, ProgressMigrationHistoryEntity } from "../../db";
import { ContentMigrationMappingEntityRepository } from "../../db/content.migration.mapping.repository";
import { ProgressMigrationHistoryEntityRepository } from "../../db/progress.migration.history.repository";
import { ContentRepoService } from "../../sdks/content-repo/apis/content.repo.service";
import { PTContentSkillCode } from "../../sdks/content-repo/dto";
import { GeneralTestService } from "../../sdks/general-test/apis";
import {
  GetGeneralTestResponseDto,
  StatefulTestResponse,
} from "../../sdks/general-test/dto";
import {
  OspContentService,
  OspStudentProgressService,
} from "../../sdks/osp/apis";
import {
  OspCourse,
  PTContentPathDto,
  PTStudentAnswerDto,
  PTTestKind,
} from "../../sdks/osp/dto";
import { StudentProgressController } from "./student.progress.controller";
import { StudentProgressService } from "./student.progress.service";

describe("StudentProgressService", () => {
  let service: StudentProgressService;
  let ospContentService: OspContentService;
  let contentRepoService: ContentRepoService;
  let ospStudentProgressService: OspStudentProgressService;
  let generalTestService: GeneralTestService;
  let entityManager: EntityManager;
  const contentMigrationMappingEntityRepository: ContentMigrationMappingEntityRepository = new ContentMigrationMappingEntityRepository();
  const progressMigrationHistoryEntityRepository: ProgressMigrationHistoryEntityRepository = new ProgressMigrationHistoryEntityRepository();
  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      imports: [HttpModule],
      controllers: [StudentProgressController],
      providers: [
        ConfigService,
        EntityManager,
        StudentProgressService,
        OspContentService,
        OspStudentProgressService,
        GeneralTestService,
        ContentRepoService,
      ],
    }).compile();

    service = module.get<StudentProgressService>(StudentProgressService);
    ospContentService = module.get<OspContentService>(OspContentService);
    contentRepoService = module.get<ContentRepoService>(ContentRepoService);
    ospStudentProgressService = module.get<OspStudentProgressService>(
      OspStudentProgressService,
    );
    generalTestService = module.get<GeneralTestService>(GeneralTestService);
    entityManager = module.get<EntityManager>(EntityManager);

    jest
      .spyOn(entityManager, "getCustomRepository")
      .mockImplementation((clazz) => {
        if (clazz === ContentMigrationMappingEntityRepository) {
          return contentMigrationMappingEntityRepository;
        }
        return progressMigrationHistoryEntityRepository;
      });
  });

  const mockOSPOperation = () => {
    jest.spyOn(ospContentService, "getPTContentPath").mockResolvedValue({
      PTKey: "eaa97dc3-ffa4-45f6-9ff2-6526462bb2da",
      TestKind: PTTestKind.UnitQuiz,
      CourseCode: OspCourse.HF,
      BookKey: "ecccb7b0-4ef6-4b1f-853c-3585f72c941c",
      BookCode: "HFJ",
      UnitKey: "333fafaf-7974-41d7-befc-6b0a5577f6ca",
      UnitCode: "unit-5",
    } as PTContentPathDto);

    jest
      .spyOn(ospStudentProgressService, "getStudentSkillScore")
      .mockResolvedValue({
        StudentId: 1070,
        BookKey: "ecccb7b0-4ef6-4b1f-853c-3585f72c941c",
        BookCode: "HFJ",
        BookName: "Book J",
        UnitKey: "333fafaf-7974-41d7-befc-6b0a5577f6ca",
        UnitCode: "unit-5",
        UnitName: "Unit 5",
        PTKey: "eaa97dc3-ffa4-45f6-9ff2-6526462bb2da",
        PTInstanceKey: "c8ec9ba0-51fc-4612-a5ed-ee20e8897323",
        IsOverwritten: false,
        PTTestBy: 2,
        PTTotalScore: undefined,
        TestKind: "Progress Test",
        SkillScores: [
          {
            Code: "grammar",
            Score: 0,
            TotalScore: 10,
            DateTaken: undefined,
          },
          {
            Code: "vocabulary",
            Score: 0,
            TotalScore: 10,
            DateTaken: undefined,
          },
          {
            Code: "listening",
            Score: 0,
            TotalScore: 10,
            DateTaken: undefined,
          },
          {
            Code: "reading",
            Score: 0,
            TotalScore: 10,
            DateTaken: undefined,
          },
        ],
      });
    jest
      .spyOn(ospStudentProgressService, "getStudentProgressTestAnswer")
      .mockResolvedValue(
        Promise.resolve([
          {
            ActivityCourseKey: "67312a5c-6018-4379-8241-6f67cee89e48",
            ActivityKey: "232b6e83-5f54-48af-aae7-bc3642003b71",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "bd652e50-6108-422c-bace-7948ce2432e4",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "19ef08cd-d506-4c60-b6ee-936f296cc1ba",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "9c155288-6724-4c9c-a910-a8be4fb97612",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: {
                    key: "232b6e83-5f54-48af-aae7-bc3642003b71",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/multipleselectlongtext-highflyersbookjunit5readinga/tags",
                    templateId: "multipleSelectLongText",
                    skillTypes: ["reading"],
                    title: "Reading A",
                    progress: 0,
                    totalProgress: 6,
                    score: 0,
                    totalScore: 6,
                    instruction: "Read and choose the correct answers.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "cb07e3b3-7d2c-4cc4-8cfb-ccb6b172a7bf",
                        title:
                          "Why did Uncle Dan take Adam to the swimming pool?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "It is safer than the ocean.",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "The ocean is too far away.",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "Adam is afraid of the ocean.",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "bd652e50-6108-422c-bace-7948ce2432e4",
                        title: "Why did Adam do some exercises?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "to become a better swimmer",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "to show Uncle Dan that he is strong",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "to get ready for diving",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "9c155288-6724-4c9c-a910-a8be4fb97612",
                        title: "Why should Adam take care of the equipment?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "because it belongs to Uncle Dan",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "so it's safe to use",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "because it is expensive",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "739ef40d-91d2-4782-901f-e1b4467a2412",
                        title: "What did Adam find most difficult?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "walking with the equipment on",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "doing the practice exercises",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "learning the hand signs",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "19ef08cd-d506-4c60-b6ee-936f296cc1ba",
                        title: "Why did the air tank become lighter?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "Adam used all of the air.",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "Adam became stronger.",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "Adam got in the water.",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "897e42b9-5d56-46c6-90a7-f96a6cc0faf8",
                        title: "What is a good title for this story?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: '"Diving with Uncle Dan"',
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: '"Learning to Talk Underwater"',
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: '"Scuba at the Beach"',
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        },
                        modelVersion: "",
                      },
                    ],
                    textStimulus: [
                      {
                        stimulusKey: "61f7fc29-d482-4daa-8d30-ac0a82804cf8",
                        text:
                          "<p>Last week, Adam's uncle Dan taught him how to scuba dive.</p>\n<p>&quot;Scuba diving can be dangerous if you are not careful,&quot; said Uncle Dan &quot;I'll show you how to do it safely.&quot; Uncle Dan took Adam to the swimming pool – Adam was very surprised!</p>\n<p>&quot;I thought we were going to the ocean!&quot; said Adam.</p>\n<p>&quot;The ocean is dangerous if you don't know what to do,&quot; said Uncle Dan. &quot;You need to practice first.&quot; Uncle Dan showed Adam how to do some exercises. Then, they both practiced swimming. &quot;It's very important to get ready before we start diving,&quot; said Uncle Dan.</p>\n<p>Next, Uncle Dan taught Adam some hand signs. &quot;You can't hear people talk when you are under the water,&quot; said Uncle Dan. &quot;If you need to say something, use your hands.&quot; Adam thought it was really cool!</p>\n<p>After that, Uncle Dan showed Adam all of the equipment. &quot;Be careful, Adam,&quot; he said. &quot;If it breaks, it will be dangerous to use.&quot; There was a big black swimsuit that covered Adam's body, a face mask and a bottle of air that Adam put on his back.</p>\n<p>&quot;This is really heavy!&quot; said Adam when he put it on. He could only walk very slowly!</p>\n<p>&quot;Don't worry,&quot; laughed Uncle Dan. &quot;It isn't heavy when you get into the water.&quot;</p>\n<p>Uncle Dan was right! When Adam got into the pool, it was easy for him to swim. Adam and Uncle Dan practiced scuba diving all day. In the evening, Adam was tired but happy. &quot;Well done,&quot; said Uncle Dan, with a big smile. &quot;Did you have fun?&quot;</p>\n<p>&quot;Yes, it was great!&quot; said Adam. &quot;I think everyone should try scuba diving.&quot;</p>\n<p>&quot;Next time we can try swimming in the ocean,&quot; said Uncle Dan. &quot;It's much more interesting than the swimming pool.&quot;</p>\n<p>&quot;Thanks, Uncle Randy,&quot; said Adam. &quot;I'm excited already!&quot;</p>",
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "45073e68-0d66-403a-8cd5-646a341ef063",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45073e68-0d66-403a-8cd5-646a341ef063",
                          mime: "image/png",
                          length: 324,
                          cultureCode: "",
                          name: "45073e68-0d66-403a-8cd5-646a341ef063",
                          quality: "",
                          type: "image",
                          hash: "J+aMSPt6Tc9UVRh69Db3Qg==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 508,
                        },
                        {
                          resourceId: "402b830b-fb2e-49d9-a496-38517c470724",
                          src:
                            "https://e1svc-staging.ef.cn/resource/402b830b-fb2e-49d9-a496-38517c470724",
                          mime: "image/png",
                          length: 22429,
                          cultureCode: "",
                          name: "402b830b-fb2e-49d9-a496-38517c470724",
                          quality: "",
                          type: "image",
                          hash: "6Je7znsL2AttmqFvBOiZwA==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "cb07e3b3-7d2c-4cc4-8cfb-ccb6b172a7bf",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "739ef40d-91d2-4782-901f-e1b4467a2412",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "897e42b9-5d56-46c6-90a7-f96a6cc0faf8",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "67312a5c-6018-4379-8241-6f67cee89e48",
            ActivityKey: "178c2931-570c-4843-95b1-c0510339e97b",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: {
                    key: "178c2931-570c-4843-95b1-c0510339e97b",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/multipleselectlongtext-highflyersbookjunit5readingb/tags",
                    templateId: "multipleSelectLongText",
                    skillTypes: ["reading"],
                    title: "Reading B",
                    progress: 0,
                    totalProgress: 4,
                    score: 0,
                    totalScore: 4,
                    instruction: "Read and choose the correct answers.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "f7e3b6bd-3be1-4cbb-92aa-188a1d7cbe33",
                        title: "This was Randy’s first time scuba diving.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "e89d6402-cf45-474d-9c38-1fa1dd689284",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "f211a66b-e232-4946-ad77-743b702a99e7",
                        title:
                          "Scuba divers can use their hands to talk underwater.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "e89d6402-cf45-474d-9c38-1fa1dd689284",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "b8e70f1b-b7c0-4b57-9057-3bab56585f06",
                        title: "Adam is excited to go scuba diving again.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "e89d6402-cf45-474d-9c38-1fa1dd689284",
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "e61d30ec-ca03-4dbc-a722-806aea917427",
                        title: "Randy prefers to go scuba diving in the pool.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        text: {
                          key: "e89d6402-cf45-474d-9c38-1fa1dd689284",
                        },
                        modelVersion: "",
                      },
                    ],
                    textStimulus: [
                      {
                        stimulusKey: "e89d6402-cf45-474d-9c38-1fa1dd689284",
                        text:
                          "<p>Last week, Adam's uncle Dan taught him how to scuba dive.</p>\n<p>&quot;Scuba diving can be dangerous if you are not careful,&quot; said Uncle Dan &quot;I'll show you how to do it safely.&quot; Uncle Dan took Adam to the swimming pool – Adam was very surprised!</p>\n<p>&quot;I thought we were going to the ocean!&quot; said Adam.</p>\n<p>&quot;The ocean is dangerous if you don't know what to do,&quot; said Uncle Dan. &quot;You need to practice first.&quot; Uncle Dan showed Adam how to do some exercises. Then, they both practiced swimming. &quot;It's very important to get ready before we start diving,&quot; said Uncle Dan.</p>\n<p>Next, Uncle Dan taught Adam some hand signs. &quot;You can't hear people talk when you are under the water,&quot; said Uncle Dan. &quot;If you need to say something, use your hands.&quot; Adam thought it was really cool!</p>\n<p>After that, Uncle Dan showed Adam all of the equipment. &quot;Be careful, Adam,&quot; he said. &quot;If it breaks, it will be dangerous to use.&quot; There was a big black swimsuit that covered Adam's body, a face mask and a bottle of air that Adam put on his back.</p>\n<p>&quot;This is really heavy!&quot; said Adam when he put it on. He could only walk very slowly!</p>\n<p>&quot;Don't worry,&quot; laughed Uncle Dan. &quot;It isn't heavy when you get into the water.&quot;</p>\n<p>Uncle Dan was right! When Adam got into the pool, it was easy for him to swim. Adam and Uncle Dan practiced scuba diving all day. In the evening, Adam was tired but happy. &quot;Well done,&quot; said Uncle Dan, with a big smile. &quot;Did you have fun?&quot;</p>\n<p>&quot;Yes, it was great!&quot; said Adam. &quot;I think everyone should try scuba diving.&quot;</p>\n<p>&quot;Next time we can try swimming in the ocean,&quot; said Uncle Dan. &quot;It's much more interesting than the swimming pool.&quot;</p>\n<p>&quot;Thanks, Uncle Randy,&quot; said Adam. &quot;I'm excited already!&quot;</p>",
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "45073e68-0d66-403a-8cd5-646a341ef063",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45073e68-0d66-403a-8cd5-646a341ef063",
                          mime: "image/png",
                          length: 324,
                          cultureCode: "",
                          name: "45073e68-0d66-403a-8cd5-646a341ef063",
                          quality: "",
                          type: "image",
                          hash: "J+aMSPt6Tc9UVRh69Db3Qg==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 508,
                        },
                        {
                          resourceId: "402b830b-fb2e-49d9-a496-38517c470724",
                          src:
                            "https://e1svc-staging.ef.cn/resource/402b830b-fb2e-49d9-a496-38517c470724",
                          mime: "image/png",
                          length: 22429,
                          cultureCode: "",
                          name: "402b830b-fb2e-49d9-a496-38517c470724",
                          quality: "",
                          type: "image",
                          hash: "6Je7znsL2AttmqFvBOiZwA==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "f7e3b6bd-3be1-4cbb-92aa-188a1d7cbe33",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "b8e70f1b-b7c0-4b57-9057-3bab56585f06",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "f211a66b-e232-4946-ad77-743b702a99e7",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "e61d30ec-ca03-4dbc-a722-806aea917427",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "59eb7492-3f02-4663-938d-a5028031dbdb",
            ActivityKey: "22d9279e-892b-4f34-8adc-1ebd2f9fca36",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "e396bb3a-22b7-455b-8a0f-20dc43291f48",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "56de2345-6fa8-4f08-bb26-295abcc93d09",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: {
                    key: "22d9279e-892b-4f34-8adc-1ebd2f9fca36",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/multipleselectaudio-highflyersbookjunit5listeningb/tags",
                    templateId: "multipleSelectAudio",
                    skillTypes: ["listening"],
                    title: "Listening B",
                    progress: 0,
                    totalProgress: 4,
                    score: 0,
                    totalScore: 4,
                    instruction: "Listen and choose the correct answers.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "f2111a15-21a0-4a8a-baba-5ae72f833426",
                        title:
                          "December is the best time to go skiing in Grant Town.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "4827bba3-5f8a-4539-91b4-26c598185eaf",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "e396bb3a-22b7-455b-8a0f-20dc43291f48",
                        title: "The skiing class is only for adults.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "4827bba3-5f8a-4539-91b4-26c598185eaf",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "56de2345-6fa8-4f08-bb26-295abcc93d09",
                        title: "Grant Town has a zoo.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "4827bba3-5f8a-4539-91b4-26c598185eaf",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "0ebccc54-29dd-466c-8277-65f37fc0b0c0",
                        title: "People can travel to Grant Town by airplane.",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "True",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "False",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "4827bba3-5f8a-4539-91b4-26c598185eaf",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                    ],
                    audioStimulus: [
                      {
                        stimulusKey: "4827bba3-5f8a-4539-91b4-26c598185eaf",
                        resources: [
                          {
                            resourceId: "a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            src:
                              "https://e1svc-staging.ef.cn/resource/a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            mime: "audio/mpeg",
                            length: 1024533,
                            cultureCode: "",
                            name: "a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            quality: "",
                            type: "audio",
                            hash: "SGqTLvPPaA4lsLEo7ux/Vw==",
                            state: 2,
                            container: "e1-osp-staging",
                            playedTimes: 0,
                            duration: 84,
                          },
                        ],
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "44102d37-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/44102d37-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 306,
                          cultureCode: "",
                          name: "44102d37-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "8A48+ie7CGRxMqJteKh3GA==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 503,
                        },
                        {
                          resourceId: "45102d37-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45102d37-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 22542,
                          cultureCode: "",
                          name: "45102d37-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "MffwcOC2jG7xxw+mJyCcag==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "f2111a15-21a0-4a8a-baba-5ae72f833426",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "0ebccc54-29dd-466c-8277-65f37fc0b0c0",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "59eb7492-3f02-4663-938d-a5028031dbdb",
            ActivityKey: "01f13420-038f-42a0-856a-b6c2404c3b21",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "0c4255a5-0cf3-4f72-9f60-06cd68fe9efc",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "46b9a657-e497-4bf0-810d-0d4dd1a2a74f",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "7e015d0d-17b2-49ae-b43d-4239b835df1a",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "33ac3d55-eed2-4d79-912a-9d79cbbe8782",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "b27e3237-b836-4100-8bcd-9f3dde541b84",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: {
                    key: "01f13420-038f-42a0-856a-b6c2404c3b21",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/multipleselectaudio-highflyersbookjunit5listeninga/tags",
                    templateId: "multipleSelectAudio",
                    skillTypes: ["listening"],
                    title: "Listening A",
                    progress: 0,
                    totalProgress: 6,
                    score: 0,
                    totalScore: 6,
                    instruction: "Listen and choose the correct answers.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "f45f8d0e-f890-4b7c-b3de-eaf89d31192e",
                        title: "When is the frozen lake beautiful?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "in the afternoon",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "in the evening",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "in the morning",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "b27e3237-b836-4100-8bcd-9f3dde541b84",
                        title:
                          "What kind of people would enjoy climbing Mount Mackenzie?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people that enjoy difficult activities",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people that enjoy snowy weather",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people that don't enjoy skiing",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "46b9a657-e497-4bf0-810d-0d4dd1a2a74f",
                        title: "What activity is good for children?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "sledding",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "skating",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "visiting the zoo",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "7e015d0d-17b2-49ae-b43d-4239b835df1a",
                        title: "Where is a good place to make new friends?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "the hotel lounge",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "the ski class",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "the winter zoo",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "33ac3d55-eed2-4d79-912a-9d79cbbe8782",
                        title: "How can people save money on this holiday?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "go sledding instead of skiing",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "travel with their families",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "spend time in the hotel lobby",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                      {
                        questionKey: "0c4255a5-0cf3-4f72-9f60-06cd68fe9efc",
                        title:
                          "What kind of people would probably enjoy visiting Grant Town?",
                        progress: 0,
                        totalProgress: 1,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        numAnswers: 1,
                        options: [
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people who like animals",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people who enjoy winter activities",
                            isAnswer: true,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                          {
                            isCorrect: false,
                            isDone: false,
                            text: "people who enjoy reading",
                            isAnswer: false,
                            selected: false,
                            disabled: false,
                            status: 0,
                          },
                        ],
                        audio: {
                          key: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                    ],
                    audioStimulus: [
                      {
                        stimulusKey: "e97d392a-caed-4594-9e29-d24b8fdbda63",
                        resources: [
                          {
                            resourceId: "a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            src:
                              "https://e1svc-staging.ef.cn/resource/a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            mime: "audio/mpeg",
                            length: 1024533,
                            cultureCode: "",
                            name: "a0a37364-cb22-488e-bf0d-c3b0645a0f08",
                            quality: "",
                            type: "audio",
                            hash: "SGqTLvPPaA4lsLEo7ux/Vw==",
                            state: 2,
                            container: "e1-osp-staging",
                            playedTimes: 0,
                            duration: 84,
                          },
                        ],
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "44102d37-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/44102d37-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 306,
                          cultureCode: "",
                          name: "44102d37-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "8A48+ie7CGRxMqJteKh3GA==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 503,
                        },
                        {
                          resourceId: "45102d37-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45102d37-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 22542,
                          cultureCode: "",
                          name: "45102d37-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "MffwcOC2jG7xxw+mJyCcag==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "f45f8d0e-f890-4b7c-b3de-eaf89d31192e",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "d64a91c0-0484-4712-bb40-d12737ddcdd1",
            ActivityKey: "8493cd0c-d185-4340-948d-1bffd453e0d4",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: {
                    key: "8493cd0c-d185-4340-948d-1bffd453e0d4",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/gapfilllongtext-highflyersbookjunit5vocabularyb/tags",
                    templateId: "gapFillLongText",
                    skillTypes: ["vocabulary"],
                    title: "Vocabulary B",
                    progress: 0,
                    totalProgress: 5,
                    score: 0,
                    totalScore: 5,
                    instruction: "Fill in the gaps.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "c96187b7-7745-45b1-b184-55d0932f8738",
                        title:
                          '<p>amazing</p> \n<p>dangerous</p> \n<p>exciting</p> \n<p>exhausting</p> \n<p>scary </p> \n<p> </p> \n<p><b>1.</b> Mountain climbing made me feel tired. It was <span data-gap-value="exhausting">exhausting</span>. </p> \n<p><b>2. </b>We found a dark cave and my friends went inside to look. I stayed outside – it was too <span data-gap-value="scary">scary</span> for me! </p> \n<p><b>3. </b>I could see the ocean from the top of the mountain. It was <span data-gap-value="amazing">amazing</span>! </p> \n<p><b>4. </b>Be careful! Hiking can be <span data-gap-value="dangerous">dangerous</span>. </p> \n<p><b>5. </b>My week was so busy! I don\'t want to do anything <span data-gap-value="exciting">exciting</span> today. I just want to relax at home. </p>',
                        progress: 0,
                        totalProgress: 5,
                        score: 0,
                        totalScore: 5,
                        numAttempts: 0,
                        isChecked: false,
                        additionalLength: 0,
                        currentGapIndex: 0,
                        gaps: [
                          {
                            index: 0,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "exhausting",
                            status: 0,
                          },
                          {
                            index: 1,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "scary",
                            status: 0,
                          },
                          {
                            index: 2,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "amazing",
                            status: 0,
                          },
                          {
                            index: 3,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "dangerous",
                            status: 0,
                          },
                          {
                            index: 4,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "exciting",
                            status: 0,
                          },
                        ],
                        maxInputLength: 10,
                        question: {
                          raw:
                            "<p>amazing</p> \n<p>dangerous</p> \n<p>exciting</p> \n<p>exhausting</p> \n<p>scary </p> \n<p> </p> \n<p><b>1.</b> Mountain climbing made me feel tired. It was <span ar-attr-gap-index='0' ar-dir-gap-fill-input=\"exhausting\">exhausting</span>. </p> \n<p><b>2. </b>We found a dark cave and my friends went inside to look. I stayed outside – it was too <span ar-attr-gap-index='1' ar-dir-gap-fill-input=\"scary\">scary</span> for me! </p> \n<p><b>3. </b>I could see the ocean from the top of the mountain. It was <span ar-attr-gap-index='2' ar-dir-gap-fill-input=\"amazing\">amazing</span>! </p> \n<p><b>4. </b>Be careful! Hiking can be <span ar-attr-gap-index='3' ar-dir-gap-fill-input=\"dangerous\">dangerous</span>. </p> \n<p><b>5. </b>My week was so busy! I don't want to do anything <span ar-attr-gap-index='4' ar-dir-gap-fill-input=\"exciting\">exciting</span> today. I just want to relax at home. </p>",
                          src:
                            '<p>amazing</p> \n<p>dangerous</p> \n<p>exciting</p> \n<p>exhausting</p> \n<p>scary </p> \n<p> </p> \n<p><b>1.</b> Mountain climbing made me feel tired. It was <span data-gap-value="exhausting">exhausting</span>. </p> \n<p><b>2. </b>We found a dark cave and my friends went inside to look. I stayed outside – it was too <span data-gap-value="scary">scary</span> for me! </p> \n<p><b>3. </b>I could see the ocean from the top of the mountain. It was <span data-gap-value="amazing">amazing</span>! </p> \n<p><b>4. </b>Be careful! Hiking can be <span data-gap-value="dangerous">dangerous</span>. </p> \n<p><b>5. </b>My week was so busy! I don\'t want to do anything <span data-gap-value="exciting">exciting</span> today. I just want to relax at home. </p>',
                        },
                        audio: {
                          key: "2311b6c8-5793-4d13-90d5-ce09bd9894ff",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                    ],
                    audioStimulus: [
                      {
                        stimulusKey: "2311b6c8-5793-4d13-90d5-ce09bd9894ff",
                        resources: [
                          {
                            resourceId: "a543df45-9408-401c-8232-649c894de105",
                            src:
                              "https://e1svc-staging.ef.cn/resource/a543df45-9408-401c-8232-649c894de105",
                            mime: "audio/mpeg",
                            length: 73141,
                            cultureCode: "",
                            name: "a543df45-9408-401c-8232-649c894de105",
                            quality: "",
                            type: "audio",
                            hash: "bRZqXa1iZmoBDCe+cQuEnA==",
                            state: 2,
                            container: "e1-osp-staging",
                            playedTimes: 0,
                            duration: 4,
                          },
                        ],
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "696f16bf-3075-4577-ab3c-0214c5a42545",
                          src:
                            "https://e1svc-staging.ef.cn/resource/696f16bf-3075-4577-ab3c-0214c5a42545",
                          mime: "image/png",
                          length: 368,
                          cultureCode: "",
                          name: "696f16bf-3075-4577-ab3c-0214c5a42545",
                          quality: "",
                          type: "image",
                          hash: "L/a91b8hpQpWQzAthSlMQw==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 765,
                        },
                        {
                          resourceId: "7e5ef638-636a-4f81-a82b-e55fde274748",
                          src:
                            "https://e1svc-staging.ef.cn/resource/7e5ef638-636a-4f81-a82b-e55fde274748",
                          mime: "image/png",
                          length: 22634,
                          cultureCode: "",
                          name: "7e5ef638-636a-4f81-a82b-e55fde274748",
                          quality: "",
                          type: "image",
                          hash: "dPj6xkYu3mDL8FkOGc0tuQ==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "c96187b7-7745-45b1-b184-55d0932f8738",
                TotalScore: 5.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "d64a91c0-0484-4712-bb40-d12737ddcdd1",
            ActivityKey: "681bde2c-7412-4b5f-a155-e1c301399742",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: {
                    key: "681bde2c-7412-4b5f-a155-e1c301399742",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/matchimagetotext-highflyersbookjunit5vocabularya/tags",
                    templateId: "matchImageToText",
                    skillTypes: ["vocabulary"],
                    title: "Vocabulary A",
                    progress: 0,
                    totalProgress: 5,
                    score: 0,
                    totalScore: 5,
                    instruction: "Read and match.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "1910d9e5-c8a0-4dc5-b711-9fcaa3c84f3e",
                        title: "",
                        progress: 0,
                        totalProgress: 5,
                        score: 0,
                        totalScore: 5,
                        numAttempts: 0,
                        isChecked: false,
                        presets: [
                          {
                            presetIdx: 0,
                            imgUrl:
                              "https://e1svc-staging.ef.cn/resource/9667af48-f7d8-e811-814a-02bc62143fc0",
                            image: [
                              {
                                resourceId:
                                  "9667af48-f7d8-e811-814a-02bc62143fc0",
                                src:
                                  "https://e1svc-staging.ef.cn/resource/9667af48-f7d8-e811-814a-02bc62143fc0",
                                mime: "image/png",
                                length: 34166,
                                cultureCode: "",
                                name: "9667af48-f7d8-e811-814a-02bc62143fc0",
                                quality: "",
                                type: "image",
                                hash: "npsWmoducNbzPZrqedVASA==",
                                state: 2,
                                container: "e1-osp-staging",
                                width: 440,
                                height: 440,
                              },
                            ],
                            pairTxt: "",
                            pairIdx: -1,
                            correctTxtIdx: 0,
                            correctTxt: "sledding",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            imgUrl:
                              "https://e1svc-staging.ef.cn/resource/9767af48-f7d8-e811-814a-02bc62143fc0",
                            image: [
                              {
                                resourceId:
                                  "9767af48-f7d8-e811-814a-02bc62143fc0",
                                src:
                                  "https://e1svc-staging.ef.cn/resource/9767af48-f7d8-e811-814a-02bc62143fc0",
                                mime: "image/png",
                                length: 50666,
                                cultureCode: "",
                                name: "9767af48-f7d8-e811-814a-02bc62143fc0",
                                quality: "",
                                type: "image",
                                hash: "ZGEOkAWdrQkLnP2YWYea9g==",
                                state: 2,
                                container: "e1-osp-staging",
                                width: 440,
                                height: 440,
                              },
                            ],
                            pairTxt: "",
                            pairIdx: -1,
                            correctTxtIdx: 1,
                            correctTxt: "hang gliding",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            imgUrl:
                              "https://e1svc-staging.ef.cn/resource/9867af48-f7d8-e811-814a-02bc62143fc0",
                            image: [
                              {
                                resourceId:
                                  "9867af48-f7d8-e811-814a-02bc62143fc0",
                                src:
                                  "https://e1svc-staging.ef.cn/resource/9867af48-f7d8-e811-814a-02bc62143fc0",
                                mime: "image/png",
                                length: 27553,
                                cultureCode: "",
                                name: "9867af48-f7d8-e811-814a-02bc62143fc0",
                                quality: "",
                                type: "image",
                                hash: "0wSyKuOD38UN/gzxrJFOJA==",
                                state: 2,
                                container: "e1-osp-staging",
                                width: 440,
                                height: 440,
                              },
                            ],
                            pairTxt: "",
                            pairIdx: -1,
                            correctTxtIdx: 2,
                            correctTxt: "making snow angels",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            imgUrl:
                              "https://e1svc-staging.ef.cn/resource/9967af48-f7d8-e811-814a-02bc62143fc0",
                            image: [
                              {
                                resourceId:
                                  "9967af48-f7d8-e811-814a-02bc62143fc0",
                                src:
                                  "https://e1svc-staging.ef.cn/resource/9967af48-f7d8-e811-814a-02bc62143fc0",
                                mime: "image/png",
                                length: 35377,
                                cultureCode: "",
                                name: "9967af48-f7d8-e811-814a-02bc62143fc0",
                                quality: "",
                                type: "image",
                                hash: "Mygrup6FwLmbYtzveW9Fiw==",
                                state: 2,
                                container: "e1-osp-staging",
                                width: 440,
                                height: 440,
                              },
                            ],
                            pairTxt: "",
                            pairIdx: -1,
                            correctTxtIdx: 3,
                            correctTxt: "caving",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            imgUrl:
                              "https://e1svc-staging.ef.cn/resource/9a67af48-f7d8-e811-814a-02bc62143fc0",
                            image: [
                              {
                                resourceId:
                                  "9a67af48-f7d8-e811-814a-02bc62143fc0",
                                src:
                                  "https://e1svc-staging.ef.cn/resource/9a67af48-f7d8-e811-814a-02bc62143fc0",
                                mime: "image/png",
                                length: 50700,
                                cultureCode: "",
                                name: "9a67af48-f7d8-e811-814a-02bc62143fc0",
                                quality: "",
                                type: "image",
                                hash: "450wxsgWYe7maQYmR3qyNA==",
                                state: 2,
                                container: "e1-osp-staging",
                                width: 440,
                                height: 440,
                              },
                            ],
                            pairTxt: "",
                            pairIdx: -1,
                            correctTxtIdx: 4,
                            correctTxt: "scuba diving",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 3,
                            inPreset: false,
                            txt: "caving",
                            positionIdx: 0,
                            positionIdxImmutable: 0,
                          },
                          {
                            responseIdx: 4,
                            inPreset: false,
                            txt: "scuba diving",
                            positionIdx: 1,
                            positionIdxImmutable: 1,
                          },
                          {
                            responseIdx: 0,
                            inPreset: false,
                            txt: "sledding",
                            positionIdx: 2,
                            positionIdxImmutable: 2,
                          },
                          {
                            responseIdx: 2,
                            inPreset: false,
                            txt: "making snow angels",
                            positionIdx: 3,
                            positionIdxImmutable: 3,
                          },
                          {
                            responseIdx: 1,
                            inPreset: false,
                            txt: "hang gliding",
                            positionIdx: 4,
                            positionIdxImmutable: 4,
                          },
                        ],
                        audio: {
                          key: "cce479ca-8dbe-44db-9ade-9645ee86201f",
                          playedTimes: 0,
                        },
                        modelVersion: "",
                      },
                    ],
                    audioStimulus: [
                      {
                        stimulusKey: "cce479ca-8dbe-44db-9ade-9645ee86201f",
                        resources: [
                          {
                            resourceId: "a543df45-9408-401c-8232-649c894de105",
                            src:
                              "https://e1svc-staging.ef.cn/resource/a543df45-9408-401c-8232-649c894de105",
                            mime: "audio/mpeg",
                            length: 73141,
                            cultureCode: "",
                            name: "a543df45-9408-401c-8232-649c894de105",
                            quality: "",
                            type: "audio",
                            hash: "bRZqXa1iZmoBDCe+cQuEnA==",
                            state: 2,
                            container: "e1-osp-staging",
                            playedTimes: 0,
                            duration: 4,
                          },
                        ],
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "d4051131-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/d4051131-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 2517,
                          cultureCode: "",
                          name: "d4051131-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "QTjqtBaDQi/M+eR3S63gEQ==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 768,
                        },
                        {
                          resourceId: "d5051131-9b9b-e811-814a-02bc62143fc0",
                          src:
                            "https://e1svc-staging.ef.cn/resource/d5051131-9b9b-e811-814a-02bc62143fc0",
                          mime: "image/png",
                          length: 22305,
                          cultureCode: "",
                          name: "d5051131-9b9b-e811-814a-02bc62143fc0",
                          quality: "",
                          type: "image",
                          hash: "mOvMnPMPC+oi0bR+fnL25w==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "1910d9e5-c8a0-4dc5-b711-9fcaa3c84f3e",
                TotalScore: 5.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "d7344c3a-f0c8-4c54-9283-d4b5f76a4fc6",
            ActivityKey: "44fea764-9051-4b39-b084-9ddb568e355e",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "554415a2-9366-4c8d-8edb-2245657fb377",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "855e3469-bef6-4d79-997f-65c9350128d1",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "eaeea406-1b52-4d70-b50e-b139531af4aa",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: undefined,
                },
                Key: undefined,
                QuestionKey: "a96ba69c-d19b-498f-b36d-bfbb97402f2d",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
              {
                Detail: {
                  modelData: {
                    key: "44fea764-9051-4b39-b084-9ddb568e355e",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/unscramble-highflyersbookjunit5grammara/tags",
                    templateId: "unscramble",
                    skillTypes: ["grammar"],
                    title: "Grammar A",
                    progress: 0,
                    totalProgress: 35,
                    score: 0,
                    totalScore: 5,
                    instruction: "Unscramble the sentences.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "56c75481-111b-4baa-b341-fb84594c6d5a",
                        title:
                          'You should take <span data-gap-value="a coat">a coat</span> <span data-gap-value="– it\'s">– it\'s</span> cold .',
                        progress: 0,
                        totalProgress: 7,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        status: 0,
                        presets: [
                          {
                            presetIdx: 0,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "0",
                            correctAnswerText: "You",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "1",
                            correctAnswerText: "should",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "2",
                            correctAnswerText: "take",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "3",
                            correctAnswerText: "a coat",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "4",
                            correctAnswerText: "– it's",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 5,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "5",
                            correctAnswerText: "cold",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 6,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "6",
                            correctAnswerText: ".",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 0,
                            inDrop: false,
                            responseText: "You",
                          },
                          {
                            responseIdx: 4,
                            inDrop: false,
                            responseText: "– it's",
                          },
                          {
                            responseIdx: 5,
                            inDrop: false,
                            responseText: "cold",
                          },
                          {
                            responseIdx: 6,
                            inDrop: false,
                            responseText: ".",
                          },
                          {
                            responseIdx: 1,
                            inDrop: false,
                            responseText: "should",
                          },
                          {
                            responseIdx: 3,
                            inDrop: false,
                            responseText: "a coat",
                          },
                          {
                            responseIdx: 2,
                            inDrop: false,
                            responseText: "take",
                          },
                        ],
                        modelVersion: "",
                      },
                      {
                        questionKey: "554415a2-9366-4c8d-8edb-2245657fb377",
                        title:
                          "We should try caving <span data-gap-value=\"– it's\">– it's</span> cool .",
                        progress: 0,
                        totalProgress: 7,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        status: 0,
                        presets: [
                          {
                            presetIdx: 0,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "0",
                            correctAnswerText: "We",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "1",
                            correctAnswerText: "should",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "2",
                            correctAnswerText: "try",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "3",
                            correctAnswerText: "caving",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "4",
                            correctAnswerText: "– it's",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 5,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "5",
                            correctAnswerText: "cool",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 6,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "6",
                            correctAnswerText: ".",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 2,
                            inDrop: false,
                            responseText: "try",
                          },
                          {
                            responseIdx: 1,
                            inDrop: false,
                            responseText: "should",
                          },
                          {
                            responseIdx: 6,
                            inDrop: false,
                            responseText: ".",
                          },
                          {
                            responseIdx: 5,
                            inDrop: false,
                            responseText: "cool",
                          },
                          {
                            responseIdx: 3,
                            inDrop: false,
                            responseText: "caving",
                          },
                          {
                            responseIdx: 4,
                            inDrop: false,
                            responseText: "– it's",
                          },
                          {
                            responseIdx: 0,
                            inDrop: false,
                            responseText: "We",
                          },
                        ],
                        modelVersion: "",
                      },
                      {
                        questionKey: "a96ba69c-d19b-498f-b36d-bfbb97402f2d",
                        title:
                          'He should go <span data-gap-value="hang gliding">hang gliding</span> <span data-gap-value="– it\'s">– it\'s</span> amazing .',
                        progress: 0,
                        totalProgress: 7,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        status: 0,
                        presets: [
                          {
                            presetIdx: 0,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "0",
                            correctAnswerText: "He",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "1",
                            correctAnswerText: "should",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "2",
                            correctAnswerText: "go",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "3",
                            correctAnswerText: "hang gliding",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "4",
                            correctAnswerText: "– it's",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 5,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "5",
                            correctAnswerText: "amazing",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 6,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "6",
                            correctAnswerText: ".",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 0,
                            inDrop: false,
                            responseText: "He",
                          },
                          {
                            responseIdx: 4,
                            inDrop: false,
                            responseText: "– it's",
                          },
                          {
                            responseIdx: 5,
                            inDrop: false,
                            responseText: "amazing",
                          },
                          {
                            responseIdx: 3,
                            inDrop: false,
                            responseText: "hang gliding",
                          },
                          {
                            responseIdx: 1,
                            inDrop: false,
                            responseText: "should",
                          },
                          {
                            responseIdx: 2,
                            inDrop: false,
                            responseText: "go",
                          },
                          {
                            responseIdx: 6,
                            inDrop: false,
                            responseText: ".",
                          },
                        ],
                        modelVersion: "",
                      },
                      {
                        questionKey: "eaeea406-1b52-4d70-b50e-b139531af4aa",
                        title:
                          'You should do <span data-gap-value="rock climbing">rock climbing</span> <span data-gap-value="– it\'s">– it\'s</span> exciting .',
                        progress: 0,
                        totalProgress: 7,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        status: 0,
                        presets: [
                          {
                            presetIdx: 0,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "0",
                            correctAnswerText: "You",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "1",
                            correctAnswerText: "should",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "2",
                            correctAnswerText: "do",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "3",
                            correctAnswerText: "rock climbing",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "4",
                            correctAnswerText: "– it's",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 5,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "5",
                            correctAnswerText: "exciting",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 6,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "6",
                            correctAnswerText: ".",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 1,
                            inDrop: false,
                            responseText: "should",
                          },
                          {
                            responseIdx: 3,
                            inDrop: false,
                            responseText: "rock climbing",
                          },
                          {
                            responseIdx: 5,
                            inDrop: false,
                            responseText: "exciting",
                          },
                          {
                            responseIdx: 0,
                            inDrop: false,
                            responseText: "You",
                          },
                          {
                            responseIdx: 4,
                            inDrop: false,
                            responseText: "– it's",
                          },
                          {
                            responseIdx: 2,
                            inDrop: false,
                            responseText: "do",
                          },
                          {
                            responseIdx: 6,
                            inDrop: false,
                            responseText: ".",
                          },
                        ],
                        modelVersion: "",
                      },
                      {
                        questionKey: "855e3469-bef6-4d79-997f-65c9350128d1",
                        title:
                          'She should watch <span data-gap-value="that movie">that movie</span> <span data-gap-value="– it\'s">– it\'s</span> great .',
                        progress: 0,
                        totalProgress: 7,
                        score: 0,
                        totalScore: 1,
                        numAttempts: 0,
                        isChecked: false,
                        status: 0,
                        presets: [
                          {
                            presetIdx: 0,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "0",
                            correctAnswerText: "She",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 1,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "1",
                            correctAnswerText: "should",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 2,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "2",
                            correctAnswerText: "watch",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 3,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "3",
                            correctAnswerText: "that movie",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 4,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "4",
                            correctAnswerText: "– it's",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 5,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "5",
                            correctAnswerText: "great",
                            status: 0,
                            isCorrect: false,
                          },
                          {
                            presetIdx: 6,
                            pairText: "",
                            pairIdx: -1,
                            correctAnswerIdx: "6",
                            correctAnswerText: ".",
                            status: 0,
                            isCorrect: false,
                          },
                        ],
                        responses: [
                          {
                            responseIdx: 5,
                            inDrop: false,
                            responseText: "great",
                          },
                          {
                            responseIdx: 4,
                            inDrop: false,
                            responseText: "– it's",
                          },
                          {
                            responseIdx: 6,
                            inDrop: false,
                            responseText: ".",
                          },
                          {
                            responseIdx: 1,
                            inDrop: false,
                            responseText: "should",
                          },
                          {
                            responseIdx: 0,
                            inDrop: false,
                            responseText: "She",
                          },
                          {
                            responseIdx: 2,
                            inDrop: false,
                            responseText: "watch",
                          },
                          {
                            responseIdx: 3,
                            inDrop: false,
                            responseText: "that movie",
                          },
                        ],
                        modelVersion: "",
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "45073e68-0d66-403a-8cd5-646a341ef063",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45073e68-0d66-403a-8cd5-646a341ef063",
                          mime: "image/png",
                          length: 324,
                          cultureCode: "",
                          name: "45073e68-0d66-403a-8cd5-646a341ef063",
                          quality: "",
                          type: "image",
                          hash: "J+aMSPt6Tc9UVRh69Db3Qg==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 508,
                        },
                        {
                          resourceId: "402b830b-fb2e-49d9-a496-38517c470724",
                          src:
                            "https://e1svc-staging.ef.cn/resource/402b830b-fb2e-49d9-a496-38517c470724",
                          mime: "image/png",
                          length: 22429,
                          cultureCode: "",
                          name: "402b830b-fb2e-49d9-a496-38517c470724",
                          quality: "",
                          type: "image",
                          hash: "6Je7znsL2AttmqFvBOiZwA==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "56c75481-111b-4baa-b341-fb84594c6d5a",
                TotalScore: 1.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
          {
            ActivityCourseKey: "d7344c3a-f0c8-4c54-9283-d4b5f76a4fc6",
            ActivityKey: "d484b972-ed2f-470b-9500-bc0a4e1e6e09",
            StudentId: "1070",
            GroupId: "0",
            Answers: [
              {
                Detail: {
                  modelData: {
                    key: "d484b972-ed2f-470b-9500-bc0a4e1e6e09",
                    snapshotKey: "",
                    activityId:
                      "highflyers/book-8/unit-5/activities/progresstest/gapfillshorttext-highflyersbookjunit5grammarb/tags",
                    templateId: "gapFillShortText",
                    skillTypes: ["grammar"],
                    title: "Grammar B",
                    progress: 0,
                    totalProgress: 5,
                    score: 0,
                    totalScore: 5,
                    instruction: "Fill in the gaps.",
                    currentPageIndex: 0,
                    pages: [
                      {
                        questionKey: "5de3e7bb-ab50-443e-b7be-d59ce9e71c59",
                        title:
                          '<p><b>1. </b>She was hungry <span data-gap-value="so">so</span> she bought a pizza. </p> \n<p><b>2. </b>It’s very cold today <span data-gap-value="so">so</span> I\'ll wear a jacket. </p> \n<p><b>3. </b>He took some photos <span data-gap-value="because">because</span> he saw some beautiful animals. </p> \n<p><b>4. </b>We took some water <span data-gap-value="because">because</span> it was very hot. </p> \n<p><b>5. </b>I don\'t have any homework <span data-gap-value="so">so</span> I\'ll read a book. </p>',
                        progress: 0,
                        totalProgress: 5,
                        score: 0,
                        totalScore: 5,
                        numAttempts: 0,
                        isChecked: false,
                        additionalLength: 0,
                        currentGapIndex: 0,
                        gaps: [
                          {
                            index: 0,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "so",
                            status: 0,
                          },
                          {
                            index: 1,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "so",
                            status: 0,
                          },
                          {
                            index: 2,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "because",
                            status: 0,
                          },
                          {
                            index: 3,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "because",
                            status: 0,
                          },
                          {
                            index: 4,
                            isDisabled: false,
                            isDone: false,
                            isFocused: false,
                            isCorrect: false,
                            currentAnswer: "",
                            correctAnswer: "so",
                            status: 0,
                          },
                        ],
                        maxInputLength: 7,
                        question: {
                          raw:
                            "<p><b>1. </b>She was hungry <span ar-attr-gap-index='0' ar-dir-gap-fill-input=\"so\">so</span> she bought a pizza. </p> \n<p><b>2. </b>It’s very cold today <span ar-attr-gap-index='1' ar-dir-gap-fill-input=\"so\">so</span> I'll wear a jacket. </p> \n<p><b>3. </b>He took some photos <span ar-attr-gap-index='2' ar-dir-gap-fill-input=\"because\">because</span> he saw some beautiful animals. </p> \n<p><b>4. </b>We took some water <span ar-attr-gap-index='3' ar-dir-gap-fill-input=\"because\">because</span> it was very hot. </p> \n<p><b>5. </b>I don't have any homework <span ar-attr-gap-index='4' ar-dir-gap-fill-input=\"so\">so</span> I'll read a book. </p>",
                          src:
                            '<p><b>1. </b>She was hungry <span data-gap-value="so">so</span> she bought a pizza. </p> \n<p><b>2. </b>It’s very cold today <span data-gap-value="so">so</span> I\'ll wear a jacket. </p> \n<p><b>3. </b>He took some photos <span data-gap-value="because">because</span> he saw some beautiful animals. </p> \n<p><b>4. </b>We took some water <span data-gap-value="because">because</span> it was very hot. </p> \n<p><b>5. </b>I don\'t have any homework <span data-gap-value="so">so</span> I\'ll read a book. </p>',
                        },
                        modelVersion: "",
                      },
                    ],
                    theme: {
                      BackGroundImages: [
                        {
                          resourceId: "45073e68-0d66-403a-8cd5-646a341ef063",
                          src:
                            "https://e1svc-staging.ef.cn/resource/45073e68-0d66-403a-8cd5-646a341ef063",
                          mime: "image/png",
                          length: 324,
                          cultureCode: "",
                          name: "45073e68-0d66-403a-8cd5-646a341ef063",
                          quality: "",
                          type: "image",
                          hash: "J+aMSPt6Tc9UVRh69Db3Qg==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 1,
                          height: 508,
                        },
                        {
                          resourceId: "cb4f5830-c087-4403-9694-39cfbf29f97a",
                          src:
                            "https://e1svc-staging.ef.cn/resource/cb4f5830-c087-4403-9694-39cfbf29f97a",
                          mime: "image/png",
                          length: 22714,
                          cultureCode: "",
                          name: "cb4f5830-c087-4403-9694-39cfbf29f97a",
                          quality: "",
                          type: "image",
                          hash: "/HcaRi01+YYP39eNpP9GiQ==",
                          state: 2,
                          container: "e1-osp-staging",
                          width: 128,
                          height: 128,
                        },
                      ],
                      Summary: undefined,
                      IntroPage: undefined,
                    },
                    modelVersion: "",
                  },
                },
                Key: undefined,
                QuestionKey: "5de3e7bb-ab50-443e-b7be-d59ce9e71c59",
                TotalScore: 5.0,
                Score: 0.0,
                Attempts: undefined,
                TotalStar: undefined,
                Star: undefined,
                Duration: undefined,
                LocalStartStamp: undefined,
                LocalEndStamp: undefined,
              },
            ],
          },
        ] as PTStudentAnswerDto[]),
      );
  };

  const mockDbOperation = () => {
    jest
      .spyOn(
        contentMigrationMappingEntityRepository,
        "findMigratedMappingByOspKey",
      )
      .mockResolvedValue({
        id: 55,
        mapType: MapType.UnitQuiz,
        ospKey: "eaa97dc3-ffa4-45f6-9ff2-6526462bb2da",
        contentPath: "highflyers/cn-3/HFJ/unit-5",
        contentId: "04330e81-3e9b-11eb-967c-47cfeb391c01",
        contentRevision: "20201215-1703-xxxx",
        createdBy: "string",
        createdTimestamp: new Date(),
        updatedBy: "string",
        updatedTimestamp: new Date(),
      });

    jest
      .spyOn(contentMigrationMappingEntityRepository, "findMigratedMappings")
      .mockResolvedValue([
        {
          id: 49,
          mapType: MapType.Activity,
          ospKey: "44fea764-9051-4b39-b084-9ddb568e355e",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "040bb060-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 51,
          mapType: MapType.Activity,
          ospKey: "d484b972-ed2f-470b-9500-bc0a4e1e6e09",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "040bb060-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 47,
          mapType: MapType.Activity,
          ospKey: "8493cd0c-d185-4340-948d-1bffd453e0d4",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "03d81d40-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 54,
          mapType: MapType.Activity,
          ospKey: "681bde2c-7412-4b5f-a155-e1c301399742",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "04330e80-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 48,
          mapType: MapType.Activity,
          ospKey: "22d9279e-892b-4f34-8adc-1ebd2f9fca36",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "03e51590-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 50,
          mapType: MapType.Activity,
          ospKey: "01f13420-038f-42a0-856a-b6c2404c3b21",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "03fe69f0-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 52,
          mapType: MapType.Activity,
          ospKey: "232b6e83-5f54-48af-aae7-bc3642003b71",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "041881a0-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
        {
          id: 53,
          mapType: MapType.Activity,
          ospKey: "178c2931-570c-4843-95b1-c0510339e97b",
          contentPath: "highflyers/cn-3/HFJ/unit-5",
          contentId: "0425a100-3e9b-11eb-967c-47cfeb391c01",
          contentRevision: "20201215-1703-xxxx",
          createdBy: "string",
          createdTimestamp: new Date(),
          updatedBy: "string",
          updatedTimestamp: new Date(),
        },
      ]);

    jest
      .spyOn(
        progressMigrationHistoryEntityRepository,
        "findProgressMigrationHistory",
      )
      .mockResolvedValue([]);

    jest
      .spyOn(progressMigrationHistoryEntityRepository, "save")
      .mockResolvedValue({} as ProgressMigrationHistoryEntity);
  };

  const mockGeneralTestOperation = () => {
    jest
      .spyOn(generalTestService, "getGeneralTest")
      .mockReturnValue(Promise.resolve([] as GetGeneralTestResponseDto[]));

    jest
      .spyOn(generalTestService, "createGeneralTest")
      .mockResolvedValue(Promise.resolve({} as StatefulTestResponse));

    jest
      .spyOn(generalTestService, "updateGeneralTest")
      .mockResolvedValue(Promise.resolve({} as StatefulTestResponse));
  };

  const mockContentRepoServiceOperation = () => {
    jest.spyOn(contentRepoService, "getContent").mockReturnValue(
      Promise.resolve([
        {
          schemaVersion: 1,
          contentRevision: "20201215-1703-xxxx",
          contentId: "04330e81-3e9b-11eb-967c-47cfeb391c01",
          data: {
            title: "Progress Test",
            duration: 30,
            skills: [
              {
                code: PTContentSkillCode.grammar,
                activityRefs: [
                  {
                    contentId: "03f171a0-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 1,
                  },
                  {
                    contentId: "040bb060-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 2,
                  },
                ],
              },
              {
                code: PTContentSkillCode.vocabulary,
                activityRefs: [
                  {
                    contentId: "03d81d40-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 1,
                  },
                  {
                    contentId: "04330e80-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 2,
                  },
                ],
              },
              {
                code: PTContentSkillCode.listening,
                activityRefs: [
                  {
                    contentId: "03e51590-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 1,
                  },
                  {
                    contentId: "03fe69f0-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 2,
                  },
                ],
              },
              {
                code: PTContentSkillCode.reading,
                activityRefs: [
                  {
                    contentId: "041881a0-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 1,
                  },
                  {
                    contentId: "0425a100-3e9b-11eb-967c-47cfeb391c01",
                    contentRevision: "20201215-1703-xxxx",
                    schemaVersion: 1,
                    activitySequence: 2,
                  },
                ],
              },
              {
                code: PTContentSkillCode.writing,
                activityRefs: [],
              },
              {
                code: PTContentSkillCode.speaking,
                activityRefs: [],
              },
            ],
          },
          domainType: "ProgressTest",
          entityType: "Progress Test",
          id: "5d749563-e131-4431-84af-db3f249bc582",
        },
      ]),
    );
  };

  it("migrate success", async () => {
    mockOSPOperation();
    mockGeneralTestOperation();
    mockDbOperation();
    mockContentRepoServiceOperation();

    const response = await service.migrate({
      progressTestKey: "eaa97dc3-ffa4-45f6-9ff2-6526462bb2da",
      studentIds: ["1070"],
    });

    expect(response.productModule).toEqual(16);
    expect(response.contentPath).toEqual("highflyers/cn-3/HFJ/unit-5");
  });
});
